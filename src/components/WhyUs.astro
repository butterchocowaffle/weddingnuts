---
import {
    IndianRupee,
    ShieldCheck,
    Handshake,
    Sparkles,
    Clock,
    HeartHandshake,
} from "lucide-react";
import SpotlightCard from "./SpotlightCard";
import defaultVideoSrc from "../assets/Holi_Colors_Splash_Background_Video.mp4";
import landingContent from "../data/landing-content.json";

const { whyUs } = landingContent;
const initialVideoSrc =
    whyUs?.initialVideo === "default" ? defaultVideoSrc : whyUs?.initialVideo;
const loopVideoSrc = whyUs?.loopVideo;
const showVideo = whyUs?.showBackgroundVideo !== false; // Default to true if undefined
const backgroundColor = whyUs?.backgroundColor || "#ffffff";
---

<section
    class="relative py-24 bg-white min-h-screen snap-start flex flex-col justify-start overflow-y-auto"
    id="why-us-section"
>
    <!-- Background Container -->
    <div
        class="absolute inset-0 z-0"
        style={!showVideo ? `background-color: ${backgroundColor};` : ""}
    >
        <!-- Video Layer -->
        {
            showVideo && (
                <div
                    id="video-container"
                    class="absolute inset-0 transition-opacity duration-1000 opacity-100"
                >
                    <!-- Loop Video (Behind, Preloaded) -->
                    <video
                        id="why-us-video-loop"
                        class="absolute inset-0 w-full h-full object-cover opacity-0 transition-opacity duration-1000"
                        muted
                        loop
                        playsinline
                        preload="auto"
                    >
                        <source src={loopVideoSrc} type="video/mp4" />
                    </video>

                    <!-- Intro Video (Front) -->
                    <video
                        id="why-us-video-intro"
                        class="absolute inset-0 w-full h-full object-cover opacity-50 transition-opacity duration-1000"
                        muted
                        playsinline
                        preload="auto"
                    >
                        <source src={initialVideoSrc} type="video/mp4" />
                    </video>
                </div>
            )
        }
    </div>

    <div
        class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-12 md:pt-20"
    >
        <!-- Content Container -->
        <div
            id="why-us-content"
            class="opacity-0 transition-opacity duration-1000"
        >
            <div class="text-center mb-12">
                <h2
                    class="text-5xl md:text-7xl font-serif font-bold mb-6 tracking-tight drop-shadow-md"
                >
                    <span class="text-[#FFFAF0] text-shadow-sm"
                        >Why Wedding</span
                    ><span class="text-marigold-500">Nuts?</span>
                </h2>
                <div class="w-32 h-1.5 bg-marigold-500 mx-auto rounded-full">
                </div>
            </div>

            <div
                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8 pb-12"
            >
                <!-- Card 1 -->
                <SpotlightCard
                    client:visible
                    spotlightColor="rgba(236, 72, 153, 0.25)"
                    className="p-8 h-full why-us-card delay-100 bg-white/95 backdrop-blur-md border-gray-100"
                >
                    <div
                        class="w-16 h-16 bg-royalPink-50 text-royalPink-600 rounded-2xl flex items-center justify-center mb-6 text-2xl group-hover:scale-110 transition-transform duration-300"
                    >
                        <IndianRupee size={32} />
                    </div>
                    <h3
                        class="text-2xl font-bold text-gray-900 mb-3 font-serif"
                    >
                        Transparent Pricing
                    </h3>
                    <p class="text-gray-600 leading-relaxed text-lg">
                        No hidden commissions. We connect you directly with
                        vendors so you get the best 'local market' rates without
                        the hassle.
                    </p>
                </SpotlightCard>

                <!-- Card 2 -->
                <SpotlightCard
                    client:visible
                    spotlightColor="rgba(245, 158, 11, 0.25)"
                    className="p-8 h-full why-us-card delay-200 bg-white/95 backdrop-blur-md border-gray-100"
                >
                    <div
                        class="w-16 h-16 bg-marigold-100 text-marigold-600 rounded-2xl flex items-center justify-center mb-6 text-2xl group-hover:scale-110 transition-transform duration-300"
                    >
                        <ShieldCheck size={32} />
                    </div>
                    <h3
                        class="text-2xl font-bold text-gray-900 mb-3 font-serif"
                    >
                        Verified Quality
                    </h3>
                    <p class="text-gray-600 leading-relaxed text-lg">
                        Every Tent-waala, Caterer, and Decorator is vetted by
                        us. We ensure they deliver exactly what they promise.
                    </p>
                </SpotlightCard>

                <!-- Card 3 -->
                <SpotlightCard
                    client:visible
                    spotlightColor="rgba(147, 51, 234, 0.25)"
                    className="p-8 h-full why-us-card delay-300 bg-white/95 backdrop-blur-md border-gray-100"
                >
                    <div
                        class="w-16 h-16 bg-purple-100 text-purple-600 rounded-2xl flex items-center justify-center mb-6 text-2xl group-hover:scale-110 transition-transform duration-300"
                    >
                        <Handshake size={32} />
                    </div>
                    <h3
                        class="text-2xl font-bold text-gray-900 mb-3 font-serif"
                    >
                        Stress-Free Planning
                    </h3>
                    <p class="text-gray-600 leading-relaxed text-lg">
                        You focus on the celebration; let our vendors handle the
                        logistics. Professionalism of a planner at zero cost to
                        you.
                    </p>
                </SpotlightCard>

                <!-- Card 4 -->
                <SpotlightCard
                    client:visible
                    spotlightColor="rgba(59, 130, 246, 0.25)"
                    className="p-8 h-full why-us-card delay-100 bg-white/95 backdrop-blur-md border-gray-100"
                >
                    <div
                        class="w-16 h-16 bg-blue-100 text-blue-600 rounded-2xl flex items-center justify-center mb-6 text-2xl group-hover:scale-110 transition-transform duration-300"
                    >
                        <Sparkles size={32} />
                    </div>
                    <h3
                        class="text-2xl font-bold text-gray-900 mb-3 font-serif"
                    >
                        Curated Experience
                    </h3>
                    <p class="text-gray-600 leading-relaxed text-lg">
                        Handpicked vendors that match your unique style and
                        vision on your big day.
                    </p>
                </SpotlightCard>

                <!-- Card 5 -->
                <SpotlightCard
                    client:visible
                    spotlightColor="rgba(16, 185, 129, 0.25)"
                    className="p-8 h-full why-us-card delay-200 bg-white/95 backdrop-blur-md border-gray-100"
                >
                    <div
                        class="w-16 h-16 bg-green-100 text-green-600 rounded-2xl flex items-center justify-center mb-6 text-2xl group-hover:scale-110 transition-transform duration-300"
                    >
                        <Clock size={32} />
                    </div>
                    <h3
                        class="text-2xl font-bold text-gray-900 mb-3 font-serif"
                    >
                        Time Saving
                    </h3>
                    <p class="text-gray-600 leading-relaxed text-lg">
                        Skip the endless calls and meetings. Get quotes and
                        availability instantly from the best.
                    </p>
                </SpotlightCard>

                <!-- Card 6 -->
                <SpotlightCard
                    client:visible
                    spotlightColor="rgba(239, 68, 68, 0.25)"
                    className="p-8 h-full why-us-card delay-300 bg-white/95 backdrop-blur-md border-gray-100"
                >
                    <div
                        class="w-16 h-16 bg-red-100 text-red-600 rounded-2xl flex items-center justify-center mb-6 text-2xl group-hover:scale-110 transition-transform duration-300"
                    >
                        <HeartHandshake size={32} />
                    </div>
                    <h3
                        class="text-2xl font-bold text-gray-900 mb-3 font-serif"
                    >
                        Dedicated Support
                    </h3>
                    <p class="text-gray-600 leading-relaxed text-lg">
                        Our team is with you every step of the way, ensuring
                        everything goes smoothly.
                    </p>
                </SpotlightCard>
            </div>
        </div>
    </div>
</section>

<script>
    const section = document.getElementById("why-us-section");
    const videoIntro = document.getElementById(
        "why-us-video-intro",
    ) as HTMLVideoElement;
    const videoLoop = document.getElementById(
        "why-us-video-loop",
    ) as HTMLVideoElement;
    const content = document.getElementById("why-us-content");
    const cards = document.querySelectorAll(".why-us-card");

    let hasPlayed = false;

    if (section && content) {
        const observer = new IntersectionObserver(
            (entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting && !hasPlayed) {
                        hasPlayed = true;

                        if (videoIntro) {
                             videoIntro
                                .play()
                                .catch((e) =>
                                    console.error("Intro video play failed:", e),
                                );
                        }

                        // 1s delay for CONTENT
                        setTimeout(() => {
                            content.classList.remove("opacity-0");
                            content.classList.add("opacity-100");
                            cards.forEach((card) =>
                                card.classList.add("anim-fade-up"),
                            );
                        }, 1000);
                    }
                });
            },
            { threshold: 0.3 },
        );
        observer.observe(section);

        // Transition Logic
        if (videoIntro && videoLoop) {
            videoIntro.addEventListener("ended", () => {
                // Start playing loop video (it's behind intro)
                videoLoop
                    .play()
                    .then(() => {
                        // Fade in the loop video (bring opacity to 50% or whatever desired)
                        videoLoop.classList.remove("opacity-0");
                        videoLoop.classList.add("opacity-50");

                        // Fade out the intro video
                        videoIntro.classList.remove("opacity-50");
                        videoIntro.classList.add("opacity-0");
                    })
                    .catch((e) => console.error("Loop video play failed:", e));
            });
        }
    }
</script>

<style>
    .anim-fade-up {
        animation: fadeInUp 0.8s ease-out forwards;
        opacity: 0;
    }

    .delay-100 {
        animation-delay: 0.1s;
    }
    .delay-200 {
        animation-delay: 0.2s;
    }
    .delay-300 {
        animation-delay: 0.3s;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
